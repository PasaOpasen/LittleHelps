data=data,
start = list(coef=0.0333,vk=1.,kk=0.))
md=nls(SM~Val^vk*(1+coef*Count)^(kk*Count),
data=data,
start = list(coef=0.0333,vk=1.,kk=1.2))
md=nls(SM~Val*(1+coef*Count)^(kk*Count),
data=data,
start = list(coef=0.0333,vk=1.,kk=1.2))
md=nls(SM~Val*(1+coef*Count)^(kk*Count),
data=data,
start = list(coef=0.0333,kk=1.2))
md=nls(SM~Val*(1+coef*Count)^(kk*Count),
data=data,
start = list(coef=0.0333,kk=1.0))
md=nls(SM~Val*(1+coef*Count)^(kk*Count),
data=data,
start = list(coef=0.0333,kk=0.006))
md=nls(SM~Val*(1+coef*Count)^(kk*Count),
data=data,
start = list(coef=0.0333,kk=0.6))
md=nls(SM~Val*(1+coef*Count)^(kk*Count),
data=data,
start = list(coef=0.0333,kk=0.06))
md=nls(SM~Val*(1+coef*Count)^(kk*Count),
data=data,
start = list(coef=0.0333,kk=0.8))
md=nls(SM~Val*(1+coef*Count)^(kk*Count),
data=data,
start = list(coef=0.33,kk=0.8))
md=nls(SM~Val*(1+coef*Count)^(Count),
data=data,
start = list(coef=0.33,kk=0.8))
md=nls(SM~Val*(1+coef*Count)^(Count),
data=data,
start = list(coef=0.033,kk=0.8))
md=nls(SM~Val*(1+coef*Count)^(Count-3),
data=data,
start = list(coef=0.033,kk=0.8))
md=nls(SM~Val*(1+coef*Count)^(kk),
data=data,
start = list(coef=0.033,kk=0.8))
Show(predict(md,data))
summary(md)
md=nls(SM~Val*(1+coef*Count)^(kk*sqrt(Count)),
data=data,
start = list(coef=0.033,kk=0.8))
md=nls(SM~Val*(1+coef*Count)^(kk*sqrt(Count)),
data=data,
start = list(coef=0.033,kk=56.8))
md=nls(SM~Val*(1+coef*Count)^(kk*sqrt(Count)),
data=data,
start = list(coef=0.033,kk=5.8))
md=nls(SM~Val*(1+coef*Count)^(kk*sqrt(Count)),
data=data,
start = list(coef=0.033,kk=0.01))
summary(md)
Show(predict(md,data))
md=nls(SM~Val*(1+coef*Count)^(kk*Count),
data=data,
start = list(coef=0.033,kk=0.01))
Show(predict(md,data))
md=nls(SM~Val*(1+coef*Count)^(kk*Count),
data=data,
start = list(coef=0.033,kk=0.1))
md=nls(SM~Val*(1+coef*Count)^(kk*Count),
data=data,
start = list(coef=0.033,kk=0.05))
md=nls(SM~Val*(1+coef*Count)^(kk*Count),
data=data,
start = list(coef=0.033,kk=0.04))
md=nls(SM~Val*(1+coef*Count)^(kk*Count),
data=data,
start = list(coef=0.033,kk=0.02))
md=nls(SM~Val*(1+coef*Count)^(kk*Count),
data=data,
start = list(coef=0.033,kk=0.01))
Show(predict(md,data))
md=nls(SM~Val*(1+coef*Count)^(kk*poly(Count,3)),
data=data,
start = list(coef=0.033,kk=0.01))
md=nls(SM~Val*(1+coef*Count)^(kk+Count*t),
data=data,
start = list(coef=0.033,kk=0.01,t=1))
md=nls(SM~Val*(1+coef*Count)^(kk+Count*t),
data=data,
start = list(coef=0.033,kk=0.01,t=0))
summary(md)
Show(predict(md,data))
data %>% ggplot(aes(x=factor(Count),y=SM/Val-1))+geom_boxplot()+theme_bw()
#data %>% ggplot(aes(x=CountGroup,y=SM/Val))+geom_boxplot()+theme_bw()
data %>% ggplot(aes(x=factor(Count),y=(SM/Val-1)/Count))+geom_boxplot()+theme_bw()
data %>% ggplot(aes(x=factor(Count),y=100*Val/SM))+geom_boxplot()+coord_flip()+theme_bw()
data %>% group_by(factor(Count)) %>% summarise(mean=t.test(100*Val/SM)$estimate)
data %>% filter(Count<=15) %>% group_by(factor(Count)) %>% summarise(mean=t.test(100*Val/SM)$estimate)
data %>% filter(Count<=15) %>% group_by(factor(Count)) %>% summarise(mean=t.test(100*Val/SM)$conf.int)
data %>% mutate(perc=100*Val/SM) %>% filter(Count<=15) %>%
group_by(factor(Count)) %>%
summarise(mean=t.test(perc)$estimate,down=t.test(perc)$conf.int[1])
data %>% mutate(perc=100*Val/SM) %>% filter(Count<=15) %>%
group_by(factor(Count)) %>%
summarise(mean=t.test(perc)$estimate,
down=t.test(perc)$conf.int[1],
up=t.test(perc)$conf.int[2])
#По этому соотношению надо бы выбросы удалить
data %>% ggplot(aes(x=factor(Count),y=100*Val/SM))+geom_boxplot()+coord_flip()+theme_bw()+
annotate("text", x = Count, y = 141.7, label = "Начальные результаты")
#По этому соотношению надо бы выбросы удалить
data %>% ggplot(aes(x=factor(Count),y=100*Val/SM))+geom_boxplot()+coord_flip()+theme_bw()+
annotate("text", x = factor(Count), y = 141.7, label = "Начальные результаты")
#По этому соотношению надо бы выбросы удалить
data %>% ggplot(aes(x=factor(Count),y=100*Val/SM))+geom_boxplot()+coord_flip()+theme_bw()+
annotate("text", x=10, y = 141.7, label = "Начальные результаты")
#По этому соотношению надо бы выбросы удалить
data %>% ggplot(aes(x=factor(Count),y=100*Val/SM))+geom_boxplot()+coord_flip()+theme_bw()+
annotate("text", x=10, y = mean(100*Val/SM), label = "Начальные результаты")
#По этому соотношению надо бы выбросы удалить
data %>% ggplot(aes(x=factor(Count),y=100*Val/SM))+geom_boxplot()+coord_flip()+theme_bw()#+
data %>% mutate(perc=100*Val/SM) %>% filter(Count<=15) %>%
group_by(factor(Count)) %>%
summarise(mean=t.test(perc)$estimate,
down=t.test(perc)$conf.int[1],
up=t.test(perc)$conf.int[2])
#как насчёт какой-то такой модели?
lm(Val/SM~Count,data) %>% summary()
md=lm(sqrt(SM)~Val+Val:Count-1,data)
summary(md)
#как насчёт какой-то такой модели?
lm(Val/SM~Count,data) %>% summary()
lm(Val/SM~Count,data) %>% plot()
lm(Val/SM~Count+I(Count^2),data) %>% plot()
#как насчёт какой-то такой модели?
lm(Val/SM~Count+I(Count^2),data) %>% summary()
3.4%%1.1
#как насчёт какой-то такой модели?
lm(Val%%Weight/SM%%Weight~Count+I(Count^2),data) %>% summary()
()
#как насчёт какой-то такой модели?
lm(Val/SM~Count+I(Count^2)+I(Val/Weight),data) %>% summary()
lm(Val/SM~Count+I(Count^2)+I(Val/Weight),data) %>% plot()
lm(Val/SM~Count:CountGroup,data) %>% summary()
View(data)
View(data)
#Загрузка данных####
library(tidyverse)
library(magrittr)
library(ggformula)
library(ggthemes)
library(tidyquant)
library(ggvis)
library(plotrix)
library(car)
#library(DAAG)
library(leaps)
data=read_tsv("data.tsv",
skip=1,col_names = F,na="",
col_types = "fddnfffnnnff",
comment="#"
) %>% tbl_df()
colnames(data)=c("Date","SM","Val","Count","Type","Sex","Experience","Age","Weight","High","Body","Mail")
data %<>%#filter(Count<=20) %>%
arrange(Val,Count,Weight) %>%  mutate(
CountGroup=cut(Count,breaks = c(1,3,6,10,20,40)),
AgeGroup=cut(Age,breaks = c(1,19,27,35,70)),
Experience=factor(Experience,levels = c("До двух лет","2-3 года","4-5 лет","6-10 лет","11-15 лет" ,"больше 15 лет"),ordered = T),
Index=Weight/(0.01*High)^2,
IndexGroup=cut(Index,breaks = c(0,16,18.5,24.99,30,35,40,60))
)%>% select(-Date)#,-Mail) %>% filter(Count>1,Val<SM)
levels(data$CountGroup)=c("2-3","4-6","7-10","11-20",">20")
levels(data$AgeGroup)=c("<20","20-27","28-35",">35")
levels(data$IndexGroup)=c("выраженный дефицит","дефицит","норма","избыток","ожирение1","ожирение2","ожирение3")
ex=data$Experience %>% as.numeric()
ex[ex==6]=5
ex %<>%factor()
levels(ex)=c("До двух лет","2-3 года","4-5 лет","6-10 лет","больше 10 лет")
data %<>%mutate(Experience=factor(ex,ordered = T))
allrows=1:nrow(data)
maxerror=2
#Функция ошибок####
Error=function(target,weight) (target-weight)^2 %>% mean() %>% sqrt()
Show=function(vals,df=data){
#vals=predict(model,df)
err=df$SM-vals
cbind(value=vals,Target=df$SM,Set=paste0(df$Val,"*",df$Count),
ERROR=abs(df$SM-vals),
ErrorPercent=abs(err)/df$SM*100,
df[,c(3:15)]) %>% tbl_df() %>% select(-Count, IndexGroup)%>% arrange(-ERROR,-ErrorPercent,Weight) %>%
filter(ERROR>1)%>% print()
cat("\n")
rg=range(err)#;print(err);print(rg)
if(rg[1]<0)cat("------------> Наибольшая ошибка в большую сторону:",-rg[1],"\n")
if(rg[2]>0)cat("------------> Наибольшая ошибка в меньшую сторону:",rg[2],"\n")
s=sum(abs(err)/df$SM*100>maxerror)
len=length(err)
cat("Модель ошиблась более чем на",maxerror,"% в",s,"случаях из",len,"(",s/len*100,"%)\n")
s=sum(abs(err)>maxerror)
cat("Модель ошиблась более чем на",maxerror,"кг в",s,"случаях из",len,"(",s/len*100,"%)\n")
cat("-------------------> Среднеквадратичная ошибка:",Error(vals,df$SM),"\n")
}
ShowErrors=function(model,power.coef=1,sum.coef=0){
Show(predict(model,data)*power.coef+sum.coef)
cat("Оценка кросс-валидации для всего набора данных",
boot::cv.glm(data,glm(formula = md$call$formula,data=data),K=10)$delta[1],"\n")
cat("Оценка кросс-валидации для не более чем 10 повторений",
boot::cv.glm(data %>% filter(Count<11),glm(formula = md$call$formula,data=data %>% filter(Count<11)),K=10)$delta[1],"\n")
cat("Оценка кросс-валидации для не более чем 6 повторений",
boot::cv.glm(data %>% filter(Count<7),glm(formula = md$call$formula,data=data %>% filter(Count<7)),K=10)$delta[1],"\n")
}
ResAn=function(res){
shapiro.test(res) %>% print()
p=ggplot(data %>% mutate(res=res),aes(x=CountGroup,y=res))+
geom_boxplot()+labs(x="Группа повторений",y="Остатки (цель - предсказание)",title="Распределения остатков в зависимости от группы повторений")+theme_bw()
print(p)
(p+facet_grid(vars(Type))) %>% print()
p+facet_grid(vars(Body),vars(Type))
}
#из этого графика можно сделать вывод, что модель неплохо работает на диапазоне 2-3, но на диапазоне 13-20 ошибка какая-то сильно отличающаяся от тенденции уменьшения ошибок, так что этот диапазон надо бы и вообще убрать, так как там уже играют роль свойства красных волокон, не говорящие о силе
ResAn(data$SM-data$Val*(1+0.0333*data$Count))
ResVal=function(vals)ResAn(data$SM-vals)
#как насчёт какой-то такой модели?
lm(Val/SM~Count+I(Count^2)+I(Val/Weight),data) %>% summary()
lm(Val/SM~Count+I(Count^2)+I(Val/Weight),data) %>% plot()
lm(Val/SM~Count:CountGroup,data) %>% summary()
#как насчёт какой-то такой модели?
lm(Val/SM~Count+I(Count^2)+I(Val/Weight),data) %>% summary()
gr=data$CountGroup %>% as.numeric()
cors=function(inds)cor(data$SM[inds],data$Val[inds])
cors(gr==4)
cors(gr<2)
cors(gr==5)
md=lm(SM~Val:Count:CountGroup+Val:CountGroup+Val+Val:Count-1,data)
ShowErrors(md)
:
#Загрузка данных####
library(tidyverse)
library(magrittr)
library(ggformula)
library(ggthemes)
library(tidyquant)
library(ggvis)
library(plotrix)
library(car)
#library(DAAG)
library(leaps)
data=read_tsv("data.tsv",
skip=1,col_names = F,na="",
col_types = "fddnfffnnnff",
comment="#"
) %>% tbl_df()
colnames(data)=c("Date","SM","Val","Count","Type","Sex","Experience","Age","Weight","High","Body","Mail")
data %<>%#filter(Count<=20) %>%
arrange(Val,Count,Weight) %>%  mutate(
CountGroup=cut(Count,breaks = c(1,3,6,10,20,40)),
AgeGroup=cut(Age,breaks = c(1,19,27,35,70)),
Experience=factor(Experience,levels = c("До двух лет","2-3 года","4-5 лет","6-10 лет","11-15 лет" ,"больше 15 лет"),ordered = T),
Index=Weight/(0.01*High)^2,
IndexGroup=cut(Index,breaks = c(0,16,18.5,24.99,30,35,40,60))
)%>% select(-Date)#,-Mail) %>% filter(Count>1,Val<SM)
levels(data$CountGroup)=c("2-3","4-6","7-10","11-20",">20")
levels(data$AgeGroup)=c("<20","20-27","28-35",">35")
levels(data$IndexGroup)=c("выраженный дефицит","дефицит","норма","избыток","ожирение1","ожирение2","ожирение3")
ex=data$Experience %>% as.numeric()
ex[ex==6]=5
ex %<>%factor()
levels(ex)=c("До двух лет","2-3 года","4-5 лет","6-10 лет","больше 10 лет")
data %<>%mutate(Experience=factor(ex,ordered = T))
allrows=1:nrow(data)
maxerror=2
#уникальные записи (где один от каждого человека берётся только одна запись)
#объяснить, по каким признакам людей считать одинаковыми
data.unique=data %>% select(AgeGroup,High,Body,Experience,Sex,IndexGroup,Mail) %>% unique()
data.unique %$%  table(Body,IndexGroup)
#Загрузка данных####
library(tidyverse)
library(magrittr)
library(ggformula)
library(ggthemes)
library(tidyquant)
library(ggvis)
library(plotrix)
library(car)
#library(DAAG)
library(leaps)
data=read_tsv("data.tsv",
skip=1,col_names = F,na="",
col_types = "fddnfffnnnff",
comment="#"
) %>% tbl_df()
colnames(data)=c("Date","SM","Val","Count","Type","Sex","Experience","Age","Weight","High","Body","Mail")
data %<>%#filter(Count<=20) %>%
arrange(Val,Count,Weight) %>%  mutate(
CountGroup=cut(Count,breaks = c(1,3,6,10,20,40)),
AgeGroup=cut(Age,breaks = c(1,19,27,35,70)),
Experience=factor(Experience,levels = c("До двух лет","2-3 года","4-5 лет","6-10 лет","11-15 лет" ,"больше 15 лет"),ordered = T),
Index=Weight/(0.01*High)^2,
IndexGroup=cut(Index,breaks = c(0,16,18.5,24.99,30,35,40,60))
)%>% select(-Date)#,-Mail) %>% filter(Count>1,Val<SM)
levels(data$CountGroup)=c("2-3","4-6","7-10","11-20",">20")
levels(data$AgeGroup)=c("<20","20-27","28-35",">35")
levels(data$IndexGroup)=c("выраженный дефицит","дефицит","норма","избыток","ожирение1","ожирение2","ожирение3")
ex=data$Experience %>% as.numeric()
ex[ex==6]=5
ex %<>%factor()
levels(ex)=c("До двух лет","2-3 года","4-5 лет","6-10 лет","больше 10 лет")
data %<>%mutate(Experience=factor(ex,ordered = T))
allrows=1:nrow(data)
maxerror=2
#уникальные записи (где один от каждого человека берётся только одна запись)
#объяснить, по каким признакам людей считать одинаковыми
data.unique=data %>% select(AgeGroup,High,Body,Experience,Sex,IndexGroup) %>% unique()
data.unique %$%  table(Body,IndexGroup)
#уникальные записи (где один от каждого человека берётся только одна запись)
#объяснить, по каким признакам людей считать одинаковыми
data.unique=data %>% select(AgeGroup,High,Body,Experience,Sex,IndexGroup,Mail) %>% unique()
#уникальные записи (где один от каждого человека берётся только одна запись)
#объяснить, по каким признакам людей считать одинаковыми
data.unique=data %>% select(AgeGroup,High,Body,Experience,Sex,IndexGroup) %>% unique()
getparam=function(vec){
ln=length(levels(vec))
x=numeric(ln)
ns=character(ln)
for(i in seq(ln)){
x[i]=sum(vec==levels(vec)[i])/length(vec)
ns[i]=paste0(levels(vec)[i]," (",round(x[i]*100,2),"%)")
}
return(list(x=x,ns=ns))
}
getPIE=function(vec,main=""){
lst=getparam(vec)
pie(x=lst$x,labels=lst$ns,main=main)
}
getFan=function(vec,main=""){
pr=getparam(vec)
fan.plot(pr$x,labels=pr$ns,main=main)
}
getPIE(data.unique$Body)
ggplot(data.unique,aes(x=Boby,col=IndexGroup))+geom_bar()
ggplot(data.unique,aes(x=Body,col=IndexGroup))+geom_bar()
ggplot(data.unique,aes(x=Body,fill=IndexGroup))+geom_bar()
ggplot(data.unique,aes(x=Body,fill=IndexGroup))+geom_bar(position=position_dodge())+theme_bw()
ggplot(data.unique,aes(x=Body,fill=IndexGroup))+geom_bar(size=2,position=position_dodge())+theme_bw()
ggplot(data.unique,aes(x=Body,fill=IndexGroup))+geom_bar(size=1,position=position_dodge())+theme_bw()
ggplot(data.unique,aes(x=Body,fill=IndexGroup))+geom_bar(size=0.1,position=position_dodge())+theme_bw()
ggplot(data.unique,aes(x=Body,fill=IndexGroup))+geom_bar(position=position_dodge2())+theme_bw()
ggplot(data.unique,aes(x=Body,fill=IndexGroup))+geom_bar(position=position_dodge2())+coord_flip()+theme_bw()
chisq.test(data.unique%>% filter(IndexGroup=="норма"||IndexGroup=="избыток") %>%select(Body,IndexGroup) %>% table())
chisq.test(data.unique%>% filter(IndexGroup=="норма"|IndexGroup=="избыток") %>%select(Body,IndexGroup) %>% table())
data.unique%>% filter(IndexGroup=="норма"|IndexGroup=="избыток") %>%select(Body,IndexGroup) %>% table()
chisq.test(data.unique%>% filter(IndexGroup=="избыток") %>%select(Body) %>% table())
data.unique%>% filter(IndexGroup=="избыток") %>%select(Body) %>% table()
chisq.test(data.unique%>% filter(IndexGroup=="ожирение1") %>%select(Body) %>% table())
data.unique%>% filter(IndexGroup=="ожирение1") %>%select(Body) %>% table()
#среди эндоморфов избыток веса встречается почаще
ggplot(data.unique,aes(x=Body,fill=IndexGroup))+geom_bar(position=position_dodge2())+
labs(x="Тип телосложения")+
coord_flip()+theme_bw()
#среди эндоморфов избыток веса встречается почаще
ggplot(data.unique,aes(x=Body,fill=IndexGroup))+geom_bar(position=position_dodge2())+
labs(x="Тип телосложения",y="Количество ответивших",col="М")+
coord_flip()+theme_bw()
#среди эндоморфов избыток веса встречается почаще
ggplot(data.unique,aes(x=Body,fill=IndexGroup))+geom_bar(position=position_dodge2())+
labs(x="Тип телосложения",y="Количество ответивших",fill="М")+
coord_flip()+theme_bw()
#среди эндоморфов избыток веса встречается почаще
ggplot(data.unique,aes(x=Body,fill=IndexGroup))+geom_bar(position=position_dodge2())+
labs(x="Тип телосложения",y="Количество ответивших",fill="Группа по индексу массы тела")+
coord_flip()+theme_bw()
#среди эндоморфов избыток веса встречается почаще
ggplot(data.unique,aes(x=Body,fill=IndexGroup))+geom_bar(position=position_dodge2())+
labs(x="Тип телосложения",y="Количество ответивших",fill="Группа по индексу\n массы тела")+
coord_flip()+theme_bw()
#среди эндоморфов избыток веса встречается почаще
ggplot(data.unique,aes(x=Body,fill=IndexGroup))+geom_bar(position=position_dodge2())+
labs(x="Тип телосложения",y="Количество ответивших",fill="Индекс\n массы тела")+
coord_flip()+theme_bw()
#среди эндоморфов избыток веса встречается почаще
ggplot(data.unique,aes(x=Body,fill=IndexGroup))+geom_bar(position=position_dodge2())+
labs(x="Тип телосложения",y="Количество ответивших",fill="Индекс\n массы\n тела")+
coord_flip()+theme_bw()
#среди эндоморфов избыток веса встречается почаще
ggplot(data.unique,aes(x=Body,fill=IndexGroup))+geom_bar(position=position_dodge2())+
labs(x="Тип телосложения",y="Количество ответивших",fill="Индекс\n массы\n  тела")+
coord_flip()+theme_bw()
library(tidyverse)
library(magrittr)
library(ggformula)
library(ggalt)
#простой цикл####
mx=function(vals,count, withcomp=T){
t=vals*(1+0.0333*count)
t[count==1]=vals[count==1]
if(withcomp){
s=t[length(t)]*(1+runif(1,0.,0.005))
return(c(t,s))
}
return(t)
}
x=c(100,120,115,105,130,120,125)
y=c(10,4,6,10,3,6,5)
vc=c(mx(x,y),mx(x+4,y),mx(x+9,y))
lb=paste0(c(x,vc[8],x+4,vc[16],x+9,vc[24]) %>% round(),"x",c(y,1,y,1,y,1))
############################
f=spline(vc,n=40)
tb=tibble(d=f$x,val=f$y,day=ifelse(d %in% 1:length(vc),1,0))
ggplot(tb)+
geom_line(aes(x=d,y=val),col="green",size=1.3)+
geom_point(aes(x=d,y=val,size=factor(day/2),col=factor(ifelse(day==1,"red","green"))))
#############################
tb=tibble(d=1:length(vc),val=vc) %>% mutate(day=factor(ifelse(d%%(length(x)+1)==0,"проходка","тренировка")))
ggplot(tb,aes(x=d,y=val))+
geom_hline(yintercept = 141,size=1.,linetype="dashed",alpha=0.8)+
geom_hline(yintercept = vc[length(vc)],size=1.,linetype="dashed",alpha=0.8)+
geom_xspline(size=1,spline_shape = -0.3,linetype="dotdash",col="green",alpha=0.9)+
geom_point(aes(col=day),size=4)+
annotate("text", x = 21, y = 141.7, label = "Начальные результаты") +
annotate("text", x = 17, y = 155.7, label = "Итоговые результаты") +
annotate("text", x = tb$d+0.4, y = tb$val-ifelse(seq(tb$d)%%8!=0,0.8,0.3), label = lb) +
labs(title='Динамика простого цикла (три прохода)',
subtitle="Использование модели помогает отследить прогрессию нагрузок",
x="Номер тренировки",
y="Требуемое усилие",
caption="Не используйте такой цикл больше 2-3 проходов подряд, он может привести к перетренированности") +
guides(color=guide_legend(title="Тип дня"))+
theme_bw()+theme(legend.position = c(0.85,0.15))#+ guides(color=FALSE)
#155 верхошанский
x=c(100,125,107.5,132.5,120,140,127.5,147.5,117.5,132.5,125,162.5)
y=c(6,5,5,4,3,3,3,2,5,2,2,1)
vc=c(mx(x,y,F),mx(x+8,y,F),mx(x+15,y,F))
lb=paste0(c(x,x+8,x+15) %>% round(),"x",c(y,y,y))
tb=tibble(d=1:length(vc),val=vc) %>% mutate(day=factor(ifelse(d%%length(x)==0,"проходка","тренировка")))
ggplot(tb,aes(x=d,y=val))+
geom_hline(yintercept = 155,size=1.,linetype="dashed",alpha=0.7)+
geom_hline(yintercept = vc[length(vc)],size=1.,linetype="dashed",alpha=0.7)+
geom_xspline(size=1,spline_shape = -0.7,linetype="dotdash",col="green",alpha=0.9)+
geom_point(aes(col=day),size=4)+
annotate("text", x = 3.5, y = 159, label = "Начальные результаты") +
annotate("text", x = 3, y = 176, label = "Итоговые результаты") +
annotate("text", x = tb$d+0.4, y = tb$val-ifelse(seq(tb$d)%%length(x)!=0,0.8,0.3), label = lb) +
labs(title='Пиковый цикл Верхошанского (три прохода)',
subtitle="Медленный подъём чуть выше бывшего максимума, затем отдых (разгон) и проходка",
x="Номер тренировки",
y="Требуемое усилие",
caption="Файл с циклом прилагается") +
guides(color=guide_legend(title="Тип дня"))+
theme_bw()+theme(legend.position = c(0.85,0.15))#+ guides(color=FALSE)
#среди эндоморфов избыток веса встречается почаще
ggplot(data.unique,aes(x=Body,fill=IndexGroup))+geom_bar(position=position_dodge2())+
labs(x="Тип телосложения",y="Количество ответивших",fill="Индекс массы тела")+
coord_flip()+theme_bw()+theme(legend.justification = "top")
#среди эндоморфов избыток веса встречается почаще
ggplot(data.unique,aes(x=Body,fill=IndexGroup))+geom_bar(position=position_dodge2())+
labs(x="Тип телосложения",y="Количество ответивших",fill="Индекс массы тела")+
coord_flip()+theme_bw()+theme(legend.position = "top")
#среди эндоморфов избыток веса встречается почаще
ggplot(data.unique,aes(x=Body,fill=IndexGroup))+geom_bar(position=position_dodge2())+
labs(x="Тип телосложения",y="Количество ответивших",fill="Индекс массы тела")+
coord_flip()+theme_bw()+theme(legend.position = "top",legend.justification = "center")
#среди эндоморфов избыток веса встречается почаще
ggplot(data.unique,aes(x=Body,fill=IndexGroup))+geom_bar(position=position_dodge2())+
labs(x="Тип телосложения",y="Количество ответивших",fill="Индекс массы тела")+
coord_flip()+theme_bw()+theme(legend.position = "top",legend.justification = "left")
#среди эндоморфов избыток веса встречается почаще
ggplot(data.unique,aes(x=Body,fill=IndexGroup))+geom_bar(position=position_dodge2())+
labs(x="Тип телосложения",y="Количество ответивших",fill="Индекс массы тела")+
coord_flip()+theme_bw()+theme(legend.position = "left")
#среди эндоморфов избыток веса встречается почаще
ggplot(data.unique,aes(x=Body,fill=IndexGroup))+geom_bar(position=position_dodge2())+
labs(x="Тип телосложения",y="Количество ответивших",fill="Индекс массы тела")+
coord_flip()+theme_bw()+theme(legend.position = "bottom")
5
getRversion()
(95/70-1)/10
(94/70-1)/10
(74/70-1)/2
(76/70-1)/3
(174/160-1)/3
library(tidyverse)
library(magrittr)
data=read_tsv("eng_survey.tsv",
skip=1,col_names = F,na="",
col_types = "fddnfffnnnffff",
comment="#"
) %>% tbl_df()
data
write_tsv(data[-c(12,14)],"eng_data.tsv")
data[-c(12,14)]
data[1]
data[1] %>% as.POSIXct()
data[1] %>% as.POSIXlt()
data[1] %>% as.Date.character()
sm=apply(data, 1, function(line) sapply(line,paste,sep='\t'))
View(sm)
sm=apply(data, 2, function(line) sapply(line,paste,sep='\t'))
sm=apply(data, 2, function(line) paste(line %>% as.character(),sep='\t'))
View(sm)
sm=apply(data, 1, function(line) paste(line %>% as.character(),sep='\t'))
View(sm)
paste(data[1,] %>% as.character())
data[1,] %>% as.character()
paste(data[1,] %>% as.character())
paste(data[1,] %>% as.character(),collapse = '\t')
library(tidyverse)
library(magrittr)
data=read_tsv("eng_survey.tsv",
skip=1,col_names = F,na="",
col_types = "fddnfffnnnffff",
comment="#"
) %>% tbl_df()
sm=apply(data[-c(12,14)], 2, function(line) paste(line %>% as.character(),collapse='\t'))
write(sm,"eng_data.tsv")
sm=apply(data[-c(12,14)], 1, function(line) paste(line %>% as.character(),collapse='\t'))
write(sm,"eng_data.tsv")
